<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qaprosoft.mybatisExample.interfaces.UnionMapper">

    <insert id="createUnion" parameterType="com.qaprosoft.mybatisExample.model.Union" useGeneratedKeys="true"
            keyProperty="id">
        <![CDATA[
        insert into world.UNIONS (UNION_NAME) values
        (
        #{name}
        )
         ]]>
    </insert>

    <insert id="createUnions" parameterType="com.qaprosoft.mybatisExample.model.Union" useGeneratedKeys="true">
        <![CDATA[
        insert into world.UNIONS (UNION_NAME) values
        ]]>
        <foreach item="union" collection="list" separator=",">
            (#{union.name})
        </foreach>
    </insert>

    <insert id="addCountry2Union" useGeneratedKeys="true">
        <![CDATA[
            INSERT INTO world.COUNTRIES_UNIONS (UNIONS_ID, COUNTRIES_ID)
            VALUES (
                #{unionId},
                #{countryId}
            )
        ]]>
    </insert>

    <sql id="getUnion">
        <![CDATA[
        SELECT U.UNION_ID, U.UNION_NAME FROM world.UNIONS U
		]]>
    </sql>

    <select id="getUnionById" resultMap="UnionResultMap">
        <include refid="getUnion"/>
        <![CDATA[
			 WHERE U.UNION_ID = #{id};
		]]>
    </select>

    <select id="getUnionByName" resultMap="UnionResultMap">
        <include refid="getUnion"/>
        <![CDATA[
			 WHERE U.UNION_NAME = #{name};
		]]>
    </select>

    <select id="getAllUnionsByCountryName" resultMap="UnionResultMap">
        <![CDATA[
        SELECT U.UNION_ID, U.UNION_NAME from UNIONS U
        where U.UNION_ID in
            (SELECT CU.UNIONS_ID
            from COUNTRIES_UNIONS CU left join COUNTRIES C on C.COUNTRY_ID=CU.COUNTRIES_ID
            WHERE
            C.COUNTRY_NAME= #{name}
            )
		]]>
    </select>

    <select id="getAllUnionsByCountry" resultMap="UnionResultMap">
        <![CDATA[
        SELECT U.UNION_ID, U.UNION_NAME from UNIONS U
        where U.UNION_ID in
            (SELECT CU.UNIONS_ID
            from COUNTRIES_UNIONS CU left join COUNTRIES C on C.COUNTRY_ID=CU.COUNTRIES_ID
            WHERE
            C.COUNTRY_ID= #{country.id}
            )
		]]>
    </select>


    <update id="updateUnionName">
        <![CDATA[
			UPDATE
			    world.UNIONS
			    SET
			    UNION_NAME = #{name}
			    WHERE UNION_ID = #{id}
		]]>
    </update>


    <select id="getCountAllUnions" resultType="java.lang.Long">
        <![CDATA[
		select count(*) from world.UNIONS
		]]>
    </select>


    <sql id="deleteUnion">
        <![CDATA[
			DELETE FROM world.UNIONS
		]]>
    </sql>

    <delete id="deleteUnionById">
        <include refid="deleteUnion"/>
        <![CDATA[
        WHERE UNION_ID = #{id}
        ]]>
    </delete>

    <delete id="deleteAllUnions">
        <include refid="deleteUnion"/>
    </delete>

    <delete id="deleteUnion">
        <include refid="deleteUnion"/>
        <![CDATA[
        WHERE UNION_NAME = #{name}
         ]]>
    </delete>

    <delete id="deleteCountryFromUnion">
        <![CDATA[
            DELETE FROM world.COUNTRIES_UNIONS
            WHERE
                UNIONS_ID = #{unionId} AND
                COUNTRIES_ID = #{countryId}
        ]]>
    </delete>

    <resultMap id="UnionResultMap" type="com.qaprosoft.mybatisExample.model.Union" autoMapping="false">
        <id property="id" column="UNION_ID"/>
        <result property="name" column="UNION_NAME"/>
    </resultMap>

</mapper>